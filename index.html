<!DOCTYPE html>
<html lang="fi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sumu Teksti-TV</title>
  <style>
    :root { --bg:#000; --fg:#fff; --accent:#0af; }
    html,body{margin:0;height:100%;background:var(--bg);color:var(--fg);
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;}
    .wrap{max-width:820px;margin:0 auto;padding:12px 10px 24px;}
    .hdr{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
    .hdr h1{font-size:18px;margin:0;letter-spacing:.5px}
    .hdr .now{opacity:.75;font-size:12px}
    .screen{border:2px solid #333;border-radius:6px;overflow:hidden}
    .bar{background:#111;color:#ddd;padding:6px 8px;font-size:13px;
         display:flex;justify-content:space-between;align-items:center}
    .bar b{color:#fff}
    .view{background:#000;padding:10px;min-height:60vh}
    pre{margin:0;white-space:pre-wrap;word-break:break-word;line-height:1.15;
        font-size:16px}
    .kbd{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:10px}
    .kbd button{background:#111;border:1px solid #333;color:#fff;font-size:18px;
      padding:10px;border-radius:6px}
    .kbd button:active{transform:scale(.98)}
    .input{margin:10px 0 2px;font-size:13px;color:#9cf}
    .status{font-size:12px;opacity:.8;margin-top:6px}
    a,button{color:#9cf}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="hdr">
      <h1>Sumu Teksti-TV</h1>
      <div class="now" id="now"></div>
    </div>

    <div class="screen">
      <div class="bar">
        <div><b>SIVU</b> <span id="pg">100</span></div>
        <div>Syötä 3 numeroa (esim. 101, 500, 600, 800)</div>
        <div><button id="homeBtn">100</button></div>
      </div>
      <div class="view"><pre id="view">Ladataan...</pre></div>
      <div class="bar">
        <div class="input">Syöte: <span id="buf">—</span></div>
        <div class="status" id="status">Valmis</div>
      </div>
    </div>

    <!-- Virtuaalinäppäimistö puhelimelle -->
    <div class="kbd" aria-label="Numeronäppäimistö">
      <button data-k="1">1</button><button data-k="2">2</button><button data-k="3">3</button>
      <button data-k="4">4</button><button data-k="5">5</button><button data-k="6">6</button>
      <button data-k="7">7</button><button data-k="8">8</button><button data-k="9">9</button>
      <button id="clr">CLR</button><button data-k="0">0</button><button id="ent">ENT</button>
    </div>

    <div class="status" style="margin-top:10px">
      Vinkki: kirjoita puhelimen näppäimistöltä esim. <b>101</b> tai paina ruudun numeroita.
      Sivut tällä hetkellä: 100, 101, 500, 600, 800.
    </div>
  </div>

  <script>
    // Sivukartta – lisää tänne uusia sivuja kun teet niitä
    const pages = {
      100: '100.tti',
      101: '101.tti',
      500: '500.tti',
      600: '600.tti',
      800: '800.tti'
    };

    const view = document.getElementById('view');
    const pgEl = document.getElementById('pg');
    const bufEl = document.getElementById('buf');
    const statusEl = document.getElementById('status');
    const homeBtn = document.getElementById('homeBtn');
    const nowEl = document.getElementById('now');

    function updateClock(){
      const d = new Date();
      nowEl.textContent = d.toLocaleDateString('fi-FI') + ' ' + d.toLocaleTimeString('fi-FI', {hour: '2-digit', minute: '2-digit'});
    }
    setInterval(updateClock, 1000); updateClock();

    let buffer = "";

    function setStatus(msg){ statusEl.textContent = msg; }

    async function loadPage(n){
      const num = String(n);
      if(!pages[n]){ setStatus(`Sivua ${num} ei ole (vielä).`); return; }
      pgEl.textContent = num;
      setStatus(`Ladataan ${num}...`);
      try{
        const res = await fetch(pages[n], {cache: "no-store"});
        if(!res.ok) throw new Error(res.status + " " + res.statusText);
        const txt = await res.text();
        // Tämä näyttää TTI-tekstin “sellaisenaan” monospacena.
        // Jos käytät väri-/ohjauskoodeja, ne näkyvät tekstinä – mikä on ok nyt.
        view.textContent = txt.replace(/\r\n/g, "\n");
        setStatus(`Sivu ${num} ladattu.`);
      }catch(e){
        view.textContent = `Virhe ladattaessa sivua ${num}:\n${e.message}`;
        setStatus(`Virhe sivulla ${num}.`);
      }
    }

    function pushDigit(d){
      buffer = (buffer + d).slice(-3); // max 3 merkkiä
      bufEl.textContent = buffer.padStart(3, '·');
      if(buffer.length === 3){
        const n = parseInt(buffer, 10);
        buffer = ""; bufEl.textContent = '—';
        loadPage(n);
      }
    }

    function clearBuf(){ buffer = ""; bufEl.textContent = '—'; }
    function enterBuf(){
      if(buffer.length){
        const n = parseInt(buffer, 10);
        buffer = ""; bufEl.textContent = '—';
        loadPage(n);
      }
    }

    // Fyysinen näppäimistö
    document.addEventListener('keydown', (e)=>{
      if(e.key >= '0' && e.key <= '9'){ pushDigit(e.key); }
      else if(e.key === 'Enter'){ enterBuf(); }
      else if(e.key === 'Backspace'){ clearBuf(); }
    });

    // Virtuaalinäppäimistö
    document.querySelectorAll('.kbd button[data-k]').forEach(b=>{
      b.addEventListener('click', ()=> pushDigit(b.dataset.k));
    });
    document.getElementById('clr').addEventListener('click', clearBuf);
    document.getElementById('ent').addEventListener('click', enterBuf);
    homeBtn.addEventListener('click', ()=> loadPage(100));

    // Käynnistä sivulla 100
    loadPage(100);
  </script>
</body>
</html>
